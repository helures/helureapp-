<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@hilure</title>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1DB954; /* Spotify green */
            --secondary-color: #1ED760;
            --text-color: #fff;
            --bg-color: #000;
            --progress-color: rgba(29, 185, 84, 0.3);
            --cursor-glow: 0 0 20px rgba(29, 185, 84, 0.7);
        }
        
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ, –∫–∞–∫ –≤ —Ç–≤–æ—ë–º –∫–æ–¥–µ */
        /* ... */
    </style>
</head>
<body>
    <div id="hilure">@hilure</div>
    
    <!-- Spotify Search Container -->
    <div class="search-container">
        <div class="search-box">
            <input type="text" id="search-input" placeholder="Search Spotify tracks...">
            <button id="search-button">Search</button>
        </div>
        <div class="search-results" id="search-results"></div>
    </div>
    
    <div class="player-container">
        <div class="track-info" id="track-info">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫</div>
        
        <div class="controls">
            <div class="nav-btns">
                <button class="nav-btn" id="prev-btn">‚èÆ</button>
                <button class="play-btn" id="play-btn">‚ñ∂</button>
                <button class="nav-btn" id="next-btn">‚è≠</button>
            </div>
            
            <div class="time-container">
                <div class="time" id="current-time">0:00</div>
                <div class="progress-container" id="progress-container">
                    <div class="progress" id="progress"></div>
                </div>
                <div class="time" id="duration">0:00</div>
            </div>
        </div>
        
        <div class="volume-container">
            <div class="volume-icon" id="volume-icon">üîä</div>
            <div class="volume-slider" id="volume-slider">
                <div class="volume-progress" id="volume-progress"></div>
            </div>
        </div>
    </div>

    <div class="visualizer" id="visualizer"></div>
    
    <div id="music-notice">
        –ù–∞–∂–º–∏—Ç–µ –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É
    </div>
    
    <script>
        // Spotify API configuration
        const SPOTIFY_CLIENT_ID = '1e01c4e6988d4115a3324eeac12eff20';
        const SPOTIFY_REDIRECT_URI = 'https://helures.github.io/helureapp-/';
        const SPOTIFY_SCOPES = 'user-read-private user-read-email streaming user-read-playback-state user-modify-playback-state';
        
        let accessToken = null;
        let spotifyPlayer = null;
        let currentTrack = null;
        let isPlaying = false;
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const playBtn = document.getElementById('play-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const progressContainer = document.getElementById('progress-container');
        const progress = document.getElementById('progress');
        const currentTimeEl = document.getElementById('current-time');
        const durationEl = document.getElementById('duration');
        const volumeIcon = document.getElementById('volume-icon');
        const volumeSlider = document.getElementById('volume-slider');
        const volumeProgress = document.getElementById('volume-progress');
        const trackInfo = document.getElementById('track-info');
        const musicNotice = document.getElementById('music-notice');
        const visualizer = document.getElementById('visualizer');
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const searchResults = document.getElementById('search-results');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Spotify Web Playback SDK
        function initSpotifyPlayer() {
            window.onSpotifyWebPlaybackSDKReady = () => {
                spotifyPlayer = new Spotify.Player({
                    name: 'Hilure Player',
                    getOAuthToken: cb => { cb(accessToken); },
                    volume: 0.7
                });
                
                spotifyPlayer.addListener('ready', ({ device_id }) => {
                    console.log('Ready with Device ID', device_id);
                    transferPlayback(device_id);
                });
                
                spotifyPlayer.addListener('player_state_changed', state => {
                    if (!state) return;
                    
                    currentTrack = state.track_window.current_track;
                    trackInfo.textContent = `${currentTrack.name} - ${currentTrack.artists[0].name}`;
                    
                    isPlaying = !state.paused;
                    playBtn.textContent = isPlaying ? '‚ùö‚ùö' : '‚ñ∂';
                    
                    // Update progress
                    const durationMs = state.duration;
                    const positionMs = state.position;
                    const progressPercent = (positionMs / durationMs) * 100;
                    progress.style.width = `${progressPercent}%`;
                    
                    // Update time display
                    currentTimeEl.textContent = formatTime(positionMs / 1000);
                    durationEl.textContent = formatTime(durationMs / 1000);
                });
                
                spotifyPlayer.connect();
            };
            
            // Load the Spotify Web Playback SDK script
            const script = document.createElement('script');
            script.src = 'https://sdk.scdn.co/spotify-player.js';
            document.body.appendChild(script);
        }
        
        // Transfer playback to our player
        function transferPlayback(deviceId) {
            fetch('https://api.spotify.com/v1/me/player', {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    device_ids: [deviceId],
                    play: false
                })
            });
        }
        
        // Authenticate with Spotify
        function authenticateSpotify() {
            const url = `https://accounts.spotify.com/authorize?client_id=${SPOTIFY_CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(SPOTIFY_REDIRECT_URI)}&scope=${encodeURIComponent(SPOTIFY_SCOPES)}`;
            
            // Try to get token from URL hash
            const hash = window.location.hash.substr(1);
            const result = hash.split('&').reduce((res, item) => {
                const parts = item.split('=');
                res[parts[0]] = parts[1];
                return res;
            }, {});
            
            if (result.access_token) {
                accessToken = result.access_token;
                initSpotifyPlayer();
                window.location.hash = '';
            } else {
                window.location.href = url;
            }
        }
        
        // Search Spotify
        async function searchSpotify(query) {
            try {
                const response = await fetch(`https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track&limit=10`, {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`
                    }
                });
                const data = await response.json();
                displaySearchResults(data.tracks.items);
            } catch (error) {
                console.error('Error searching Spotify:', error);
                searchResults.innerHTML = '<div class="track-result">Error loading results. Please try again.</div>';
                searchResults.style.display = 'block';
            }
        }
        
        function displaySearchResults(tracks) {
            searchResults.innerHTML = '';
            
            if (!tracks || tracks.length === 0) {
                searchResults.innerHTML = '<div class="track-result">No tracks found</div>';
                searchResults.style.display = 'block';
                return;
            }
            
            tracks.forEach(track => {
                const trackElement = document.createElement('div');
                trackElement.className = 'track-result';
                trackElement.innerHTML = `
                    <img src="${track.album.images[0]?.url || 'https://i.scdn.co/image/ab67616d0000b27384243a01af3c77b5fe8f8803'}" alt="${track.name}">
                    <div class="track-result-info">
                        <div class="track-result-title">${track.name}</div>
                        <div class="track-result-artist">${track.artists[0].name}</div>
                    </div>
                `;
                
                trackElement.addEventListener('click', () => {
                    playSpotifyTrack(track.uri);
                });
                
                searchResults.appendChild(trackElement);
            });
            
            searchResults.style.display = 'block';
        }
        
        function playSpotifyTrack(trackUri) {
            fetch('https://api.spotify.com/v1/me/player/play', {
                method: 'PUT',
                headers: {
                    'Authorization': `Bearer ${accessToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    uris: [trackUri]
                })
            }).then(() => {
                isPlaying = true;
                playBtn.textContent = '‚ùö‚ùö';
                musicNotice.style.display = 'none';
            }).catch(error => {
                console.error('Error playing track:', error);
                musicNotice.textContent = 'Error playing track. Please try again.';
                musicNotice.style.display = 'block';
            });
            
            searchResults.style.display = 'none';
            searchInput.value = '';
        }
        
        // Player controls
        function togglePlay() {
            if (!spotifyPlayer) return;
            
            if (isPlaying) {
                spotifyPlayer.pause();
            } else {
                spotifyPlayer.resume();
            }
        }
        
        function nextTrack() {
            if (spotifyPlayer) {
                spotifyPlayer.nextTrack();
            }
        }
        
        function prevTrack() {
            if (spotifyPlayer) {
                spotifyPlayer.previousTrack();
            }
        }
        
        // Format time
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        // Set volume
        function setVolume(e) {
            if (!spotifyPlayer) return;
            
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const volume = Math.min(1, Math.max(0, clickX / width));
            spotifyPlayer.setVolume(volume);
            volumeProgress.style.width = `${volume * 100}%`;
            
            if (volume === 0) {
                volumeIcon.textContent = 'üîá';
            } else if (volume < 0.5) {
                volumeIcon.textContent = 'üîâ';
            } else {
                volumeIcon.textContent = 'üîä';
            }
        }
        
        // Toggle mute
        function toggleMute() {
            if (!spotifyPlayer) return;
            
            spotifyPlayer.getVolume().then(volume => {
                if (volume > 0) {
                    spotifyPlayer.setVolume(0);
                    volumeIcon.textContent = 'üîá';
                    volumeProgress.style.width = '0%';
                } else {
                    spotifyPlayer.setVolume(0.7);
                    volumeIcon.textContent = 'üîä';
                    volumeProgress.style.width = '70%';
                }
            });
        }
        
        // Initialize
        function init() {
            authenticateSpotify();
            
            // Event listeners
            playBtn.addEventListener('click', togglePlay);
            prevBtn.addEventListener('click', prevTrack);
            nextBtn.addEventListener('click', nextTrack);
            volumeSlider.addEventListener('click', setVolume);
            volumeIcon.addEventListener('click', toggleMute);
            
            // Spotify search
            searchButton.addEventListener('click', () => {
                if (searchInput.value.trim()) {
                    searchSpotify(searchInput.value);
                }
            });
            
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && searchInput.value.trim()) {
                    searchSpotify(searchInput.value);
                }
            });
            
            document.addEventListener('click', (e) => {
                if (!searchResults.contains(e.target)) {
                    searchResults.style.display = 'none';
                }
            });
            
            document.body.addEventListener('click', () => {
                musicNotice.style.display = 'none';
            }, { once: true });
        }
        
        // Start the app
        init();
    </script>
</body>
</html>
